{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://kit.fontawesome.com/64d58efce2.js" crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <title>Sign in & Sign up Form(OTP)</title>
</head>
<body>
    <div class="container">
        <div class="forms-container">
            <div class="signin-signup">
                <form action="{% url 'Login' %}" class="sign-up-form">
                    <h2 class="title">Account Verification</h2>
                    <!-- OTP Container -->
                    <div class="otp-container">
                        <div class="input-field">
                            <i class="fas fa-lock"></i>
                            <input type="text" placeholder="OTP" id="otp">  
                        </div>
                    </div>
                    <!-- "Verify OTP" button -->
                    <button type="submit" class="btn otp-btn" id="actionButton">Verify OTP</button>
                </form> 
            </div>
        </div>
        <div class="panels-container">
          <div class="panel left-panel">
              <div class="content">
                  <h3>Account is not verified?</h3>
                  <p></p>
                  <button class="btn transparent" id="sign-up-btn">Verify</button>
              </div>
              <img src="{% static 'images/log.svg' %}" class="image" alt="">
          </div>
          <div class="panel right-panel">
              <div class="content">
                  <h3>One of us ?</h3>
                  <p></p>
                  <a href="{% url 'Login' %}" class="btn transparent" id="sign-in-btn">Sign In</a>
              </div>
              <img src="{% static 'images/register.svg' %}" class="image" alt="">
          </div>
        </div>
    </div>
    <script src="{% static 'js/app.js' %}"></script>
    <script>
        // Automatically click the "Sign Up" button when the verify.html page is loaded
        document.addEventListener("DOMContentLoaded", function() {
            const signUpButton = document.querySelector("#sign-up-btn");
            signUpButton.click();
        });
    </script>
    <script>
        $('#actionButton').click(function(e){
            e.preventDefault();
            let otp = $('#otp').val();
            if(otp == '{{otp}}'){
                console.log("OTP Matched!")
                
                $.ajax({
                    type: "POST",
                    url: "{% url 'Login' %}",
                    data: {
                        'verified-email': '{{email}}',
                        'password': '{{password}}',
                        csrfmiddlewaretoken: '{{csrf_token}}'
                    } 
                })
                .done(function(){
                    alert("Your email has been verified!")
                    window.location.href = '/fill_application/{{email}}'
                })
                .fail(function(){
                    alert("Email was not verified, please try again!")
                })
            }
            else{
                alert("Incorrect OTP, please retry.")
            }
        })
    </script>
</body>
</html>
